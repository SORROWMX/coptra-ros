# GitHub Actions для Coptra

Этот репозиторий содержит GitHub Actions workflows для автоматической сборки и тестирования Coptra - ROS Noetic образа для Orange Pi 3B.

## Workflows

### 1. `build-image.yaml` - Сборка образа Orange Pi 3B
**Триггеры:**
- Push в ветки `main` или `master`
- Pull Request в ветки `main` или `master`
- Создание релиза (release)
- Ручной запуск (workflow_dispatch)

**Что делает:**
- Собирает полный образ Orange Pi 3B с ROS Noetic
- Настраивает WiFi Access Point
- Устанавливает веб-интерфейс
- Создает архив образа
- Загружает образ в релиз (при создании релиза)

### 2. `build.yml` - Сборка ROS пакетов
**Триггеры:**
- Push в ветки `main` или `master`
- Pull Request в ветки `main` или `master`
- Ручной запуск (workflow_dispatch)

**Что делает:**
- Собирает ROS пакеты Coptra
- Устанавливает зависимости для Orange Pi 3B
- Запускает тесты
- Создает Debian пакеты
- Загружает артефакты сборки

### 3. `test-orange-pi.yml` - Тестирование совместимости
**Триггеры:**
- Push в ветки `main` или `master`
- Pull Request в ветки `main` или `master`
- Ручной запуск (workflow_dispatch)

**Что делает:**
- Тестирует ARM64 эмуляцию
- Проверяет совместимость с Orange Pi 3B
- Тестирует установку ROS Noetic на ARM64
- Проверяет Orange Pi специфичные пакеты
- Валидирует скрипты конфигурации

### 4. `release.yml` - Создание релизов
**Триггеры:**
- Push тегов (v*)
- Ручной запуск с указанием версии

**Что делает:**
- Создает релиз с автоматическими заметками
- Генерирует changelog из git коммитов
- Запускает сборку образа

## Как использовать

### Автоматическая сборка при push
```bash
git push origin main
```
Это запустит все workflows автоматически.

### Создание релиза
```bash
# Создать тег
git tag v0.25.0
git push origin v0.25.0

# Или через GitHub UI: Actions -> Create Release -> Run workflow
```

### Ручной запуск сборки
1. Перейдите в GitHub Actions
2. Выберите нужный workflow
3. Нажмите "Run workflow"
4. Выберите ветку и нажмите "Run workflow"

## Результаты сборки

### Артефакты
- **coptra-debian-packages**: Debian пакеты ROS
- **build-logs**: Логи сборки (при ошибках)
- **coptra-orange-pi3b-*.zip**: Готовый образ для записи на SD карту

### Релизы
При создании релиза автоматически:
- Собирается образ Orange Pi 3B
- Создается архив с образом
- Загружается в релиз с подробным описанием

## Требования

### Для локальной разработки
- Docker с поддержкой ARM64 эмуляции
- QEMU для эмуляции Orange Pi 3B
- Git

### Для GitHub Actions
- Репозиторий с включенными GitHub Actions
- Права на создание релизов
- Достаточно места для артефактов

## Структура файлов

```
.github/
├── workflows/
│   ├── build-image.yaml      # Сборка образа
│   ├── build.yml            # Сборка ROS пакетов
│   ├── test-orange-pi.yml   # Тестирование
│   └── release.yml          # Создание релизов
└── README.md               # Эта документация
```

## Troubleshooting

### Ошибки сборки
1. Проверьте логи в GitHub Actions
2. Убедитесь, что все зависимости установлены
3. Проверьте совместимость с Orange Pi 3B

### Проблемы с ARM64 эмуляцией
1. Убедитесь, что Docker поддерживает multiarch
2. Проверьте настройки QEMU
3. Попробуйте перезапустить workflow

### Ошибки загрузки релизов
1. Проверьте права доступа к репозиторию
2. Убедитесь, что GITHUB_TOKEN настроен
3. Проверьте размер файлов (лимит GitHub)

## Поддержка

При возникновении проблем:
1. Проверьте Issues в репозитории
2. Создайте новый Issue с подробным описанием
3. Приложите логи из GitHub Actions
